<Window x:Class="ClanBattleGame.View.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ClanBattleGame"
        xmlns:conv="clr-namespace:ClanBattleGame.Core"
        xmlns:vm="clr-namespace:ClanBattleGame.ViewModel"
        xmlns:iface="clr-namespace:ClanBattleGame.Interface"
        xmlns:etc="clr-namespace:ClanBattleGame.Model.Etc"
        mc:Ignorable="d"
        Title="MainWindow" Height="560" Width="960">

    <Window.Resources>
        <conv:UnitIsLeaderConverter x:Key="UnitIsLeaderConverter"/>
    </Window.Resources>

    <Window.DataContext>
        <vm:BattleVM/>
    </Window.DataContext>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <GroupBox Header="Дії"
          Grid.Column="1"
          FontSize="18"
          FontWeight="Bold"
          Padding="10">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="10*"/>
                </Grid.RowDefinitions>

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>


                <!-- Кнопка: один раунд -->
                <Button Grid.Row="0"
                        Grid.Column="0"
                Content="Раунд"
                Width="120"
                Height="30"
                Command="{Binding RoundCommand}"/>

                <!-- Кнопка: повний бій -->
                <Button Grid.Row="1"
                        Grid.Column="0"
                Content="Бій до кінця"
                Width="120"
                Height="30"
                Command="{Binding FullBattleCommand}"/>

                <!-- Логи бою -->
                <TextBox Grid.Row="2"
                         Grid.ColumnSpan="2"
                 Text="{Binding BattleLog}"
                 FontSize="14"
                 TextWrapping="Wrap"
                 VerticalScrollBarVisibility="Auto"
                 AcceptsReturn="True"
                 IsReadOnly="True"/>
                
                <Button Grid.Row="0"
                        Grid.Column="1"
                    Content="Save"
                    Width="120"
                    Height="30"
                    Command="{Binding SaveCommand}"/>
                
                <Button Grid.Row="1"
                        Grid.Column="1"
                    Content="Відновити"
                    Width="120"
                    Height="30"
                    Command="{Binding RestoreCommand}"/>
            </Grid>
        </GroupBox>

        <!-- ========================== -->
        <!--           CLAN A           -->
        <!-- ========================== -->
        <GroupBox Header="{Binding ClanA.Name}"
              Grid.Column="0"
              FontSize="18"
              FontWeight="Bold"
              Padding="10">

            <ScrollViewer VerticalScrollBarVisibility="Auto">

                <ItemsControl ItemsSource="{Binding SquadsA}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Expander Header="{Binding Name}"
                                  Margin="0 0 0 10"
                                  Padding="5"
                                  Background="#eee">

                                <ListBox ItemsSource="{Binding Units}"
                                     BorderThickness="0"
                                     Background="Transparent">

                                    <ListBox.ItemTemplate>
                                        <DataTemplate DataType="{x:Type iface:IUnit}">
                                            <Border Padding="5" Margin="3"
            BorderBrush="#444"
            BorderThickness="1"
            Background="#fafafa">

                                                <StackPanel>

                                                    <!-- NAME -->
                                                    <TextBlock Text="{Binding Name}" FontSize="14" FontWeight="Bold">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding ., Converter={StaticResource UnitIsLeaderConverter}}"
                                         Value="True">
                                                                        <Setter Property="Foreground" Value="Gold"/>
                                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>

                                                    <!-- TYPE -->
                                                    <TextBlock Text="{Binding Type}" FontStyle="Italic" Foreground="#666"/>

                                                    <!-- HP / ATK -->
                                                    <StackPanel Orientation="Horizontal" Margin="0 2 0 0">
                                                        <TextBlock Text="HP:" FontWeight="Bold"/>
                                                        <TextBlock Text="{Binding Health}" Margin="4 0 10 0"/>

                                                        <TextBlock Text="ATK:" FontWeight="Bold"/>
                                                        <TextBlock Text="{Binding TotalAttack}" Margin="4 0 0 0"/>
                                                    </StackPanel>

                                                    <!-- Weapon -->
                                                    <TextBlock Text="{Binding Weapon}" Foreground="#888"/>

                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>

                                </ListBox>
                            </Expander>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

            </ScrollViewer>
        </GroupBox>



        <!-- ========================== -->
        <!--           CLAN B           -->
        <!-- ========================== -->

        <GroupBox Header="{Binding ClanB.Name}"
              Grid.Column="2"
              FontSize="18"
              FontWeight="Bold"
              Padding="10">

            <ScrollViewer VerticalScrollBarVisibility="Auto">

                <ItemsControl ItemsSource="{Binding SquadsB}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Expander Header="{Binding Name}"
                                  Margin="0 0 0 10"
                                  Padding="5"
                                  Background="#eee">

                                <ListBox ItemsSource="{Binding Units}"
                                     BorderThickness="0"
                                     Background="Transparent">

                                    <ListBox.ItemTemplate>
                                        <DataTemplate DataType="{x:Type iface:IUnit}">
                                            <Border Padding="5" Margin="3"
            BorderBrush="#444"
            BorderThickness="1"
            Background="#fafafa">

                                                <StackPanel>

                                                    <!-- NAME -->
                                                    <TextBlock Text="{Binding Name}" FontSize="14" FontWeight="Bold">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding ., Converter={StaticResource UnitIsLeaderConverter}}"
                                         Value="True">
                                                                        <Setter Property="Foreground" Value="Gold"/>
                                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>

                                                    <!-- TYPE -->
                                                    <TextBlock Text="{Binding Type}" FontStyle="Italic" Foreground="#666"/>

                                                    <!-- HP / ATK -->
                                                    <StackPanel Orientation="Horizontal" Margin="0 2 0 0">
                                                        <TextBlock Text="HP:" FontWeight="Bold"/>
                                                        <TextBlock Text="{Binding Health}" Margin="4 0 10 0"/>

                                                        <TextBlock Text="ATK:" FontWeight="Bold"/>
                                                        <TextBlock Text="{Binding TotalAttack}" Margin="4 0 0 0"/>
                                                    </StackPanel>

                                                    <!-- Weapon -->
                                                    <TextBlock Text="{Binding Weapon}" Foreground="#888"/>

                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>

                                </ListBox>
                            </Expander>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

            </ScrollViewer>
        </GroupBox>

        <Frame Grid.ColumnSpan="3" x:Name="MainFrame"
               NavigationUIVisibility="Hidden"/>

    </Grid>
</Window>
